# docker-compose.mcp-obsidian.yml.j2
# Managed by Ansible

services:
  {{ mcp_obsidian_container_name }}:
    image: {{ mcp_obsidian_image }}
    container_name: {{ mcp_obsidian_container_name }}
    restart: unless-stopped
    working_dir: /app
    command: sh -c "npm install -g {{ mcp_obsidian_npm_package }} && exec npx {{ mcp_obsidian_npm_package }} /vault"
    stdin_open: true
    tty: true
    volumes:
      - {{ mcp_obsidian_vault_path }}:/vault:rw
{% if mcp_network_mode == 'host' %}
    network_mode: host
{% else %}
    networks:
      - {{ mcp_docker_network }}
{% endif %}

{% if mcp_network_mode != 'host' %}
networks:
  {{ mcp_docker_network }}:
    external: true
{% endif %}
