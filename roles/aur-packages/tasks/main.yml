---
- name: AUR - Install packages from aur_installed_packages list
  kewlfft.aur.aur:
    use: paru
    name: "{{ aur_installed_packages }}"
  become: false
  when: aur_installed_packages is defined and aur_installed_packages | length > 0
  tags: ['aur-packages']

- name: AUR - Update all packages
  community.general.pacman:
    aur: true
    upgrade: yes
    executable: /usr/bin/paru
  become: false
  tags: ['aur-packages']

- name: Revert sudoers to original
  ansible.builtin.copy:
    src: /etc/sudoers.ansible_backup
    dest: /etc/sudoers
    owner: "{{ 'root' }}"
    mode: "0644"
    remote_src: yes
    validate: /usr/sbin/visudo -cf %s
  become: true
  tags: ['aur']
