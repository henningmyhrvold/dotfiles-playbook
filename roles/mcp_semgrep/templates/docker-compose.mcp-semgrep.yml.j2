# docker-compose.mcp-semgrep.yml.j2
# Managed by Ansible

services:
  {{ mcp_semgrep_container_name }}:
    image: {{ mcp_semgrep_image }}
    container_name: {{ mcp_semgrep_container_name }}
    restart: unless-stopped
    working_dir: /app
    command: sh -c "pip install {{ mcp_semgrep_npm_package }} && exec python -m mcp_semgrep"
    stdin_open: true
    tty: true
    volumes:
{% for dir in mcp_semgrep_scan_dirs %}
      - {{ dir }}:/scan{{ loop.index }}:ro
{% endfor %}
{% if semgrep_api_token %}
    environment:
      - SEMGREP_API_TOKEN={{ semgrep_api_token }}
      - SEMGREP_RULES={{ mcp_semgrep_rules }}
{% endif %}
{% if mcp_network_mode == 'host' %}
    network_mode: host
{% else %}
    networks:
      - {{ mcp_docker_network }}
{% endif %}

{% if mcp_network_mode != 'host' %}
networks:
  {{ mcp_docker_network }}:
    external: true
{% endif %}
